name: Create/Update K8s Secrets

# Run manually when secrets need to be created or updated
on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to update (dev, preprod, prod, or all)'
        required: true
        default: 'all'
        type: choice
        options:
          - all
          - dev
          - preprod
          - prod

jobs:
  create-secrets:
    name: Create K8s Secrets
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Install kubectl
        uses: azure/setup-kubectl@v3
        with:
          version: 'latest'
      
      - name: Configure kubectl (placeholder)
        run: |
          echo "⚠️ kubectl configuration needed"
          echo ""
          echo "To use this workflow, you need to:"
          echo "1. Set up GitHub OIDC with your K8s cluster"
          echo "2. OR provide kubeconfig as GitHub Secret"
          echo "3. OR use a self-hosted runner on the Pi"
          echo ""
          echo "For now, run these commands manually on the Pi:"
          echo ""
          echo "# Create dev secret"
          echo "kubectl create secret generic openluffy-dev-api-keys \\"
          echo "  --from-literal=claude-api-key=${{ secrets.ANTHROPIC_API_KEY }} \\"
          echo "  -n openluffy-dev \\"
          echo "  --dry-run=client -o yaml | kubectl apply -f -"
          echo ""
          echo "# Create preprod secret"
          echo "kubectl create secret generic openluffy-preprod-api-keys \\"
          echo "  --from-literal=claude-api-key=${{ secrets.ANTHROPIC_API_KEY }} \\"
          echo "  -n openluffy-preprod \\"
          echo "  --dry-run=client -o yaml | kubectl apply -f -"
          echo ""
          echo "# Create prod secret"
          echo "kubectl create secret generic openluffy-prod-api-keys \\"
          echo "  --from-literal=claude-api-key=${{ secrets.ANTHROPIC_API_KEY }} \\"
          echo "  -n openluffy-prod \\"
          echo "  --dry-run=client -o yaml | kubectl apply -f -"
